# 🛀 查询处理和优化



## 一、查询处理

关系数据库管理系统查询处理可以分为4个阶段：

- 查询分析
- 查询检查
- 查询优化
- 查询执行

![](https://gitee.com/veal98/images/raw/master/img/20200417110226.png)

### 1. 查询分析

**首先对查询语句进行扫描、语法分析和词法分析**。从查询语句中识别出语言符号，如SQL关键字、属性名和关系名等，进行语法检查和语法分析，**判断查询语句是否符合SQL语法规则**

### 2. 查询检查

**对合法的查询语句进行语义检查，即检查数据库对象，如关系名、属性名是否存在和有效。**

还要根据用户权限和完整性约束定义对用户的存取权限进行检查。如果用户没有相应权限或者违反了完整性约束，就拒绝执行该查询。

检查过后将SQL查询语句转成内部表示即等价的关系代数表达式，一般用 **查询树 / 语法分析树** 来表示扩展的关系代数表达式

### 3. 查询优化

**查询优化就是优化器选择一个高效执行的查询处理策略，以获得最好的查询优化效果**

按照优化的层次分为代数优化和物理优化

### 4. 查询执行

根据优化器得到的执行策略生成查询执行计划，由代码生成器生成执行这个查询计划的代码，然后加以执行，并返回查询结果

## 二、查询优化

查询优化的优点不仅在于用户不必考虑如何最好的表达查询以获得较高的效率，而且在于系统可以比用户程序的优化做的更好

### 1. 代数优化

代数优化就是通过对关系代数式的等价变换来提高查询效率

代数优化改变的是查询语句中操作的次序和组合，但不涉及底层的存取路径

### 2. 物理优化

物理优化就是选择高效合理的操作算法或者存取路径来达到查询优化的目标

选择的方法如下

- 基于规则的启发式优化
- 基于代价估算的优化
- 两者结合的优化方法